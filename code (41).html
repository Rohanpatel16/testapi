<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SalesBlink Email Verifier (via Proxy)</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
            color: #333;
        }
        .container {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            max-width: 600px;
            margin: auto;
        }
        h1 {
            color: #007bff;
            text-align: center;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="email"], input[type="text"] {
            width: calc(100% - 22px);
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease;
        }
        button:hover {
            background-color: #0056b3;
        }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        #responseArea, #errorArea {
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
            white-space: pre-wrap; /* Preserve formatting for JSON */
            word-wrap: break-word;
        }
        #responseArea {
            background-color: #e9f7ef;
            border: 1px solid #5cb85c;
            color: #3c763d;
        }
        #errorArea {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .hidden {
            display: none;
        }
        .warning {
            background-color: #fff3cd;
            color: #856404;
            padding: 10px;
            border: 1px solid #ffeeba;
            border-radius: 4px;
            margin-bottom: 15px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>SalesBlink Email Verifier (via Proxy)</h1>
        <div class="warning">
            <strong>Warning:</strong> This example uses a public CORS proxy (`https://cors-anywhere.herokuapp.com/`)
            for demonstration. Public proxies can be unreliable and pose security risks for sensitive data.
            Do NOT use public proxies for production or with real sensitive information.
            <br><strong>Action Required:</strong> If you see a 403 error from the proxy, you likely need to
            <a href="https://cors-anywhere.herokuapp.com/" target="_blank" rel="noopener noreferrer">visit the proxy's page</a>
            and click the button to "Request temporary access to the demo server", then try again.
        </div>

        <div>
            <label for="email">Email Address:</label>
            <input type="email" id="email" value="bs01@tigihr.com">
        </div>

        <div>
            <label for="ipAddress">IP Address (Optional, for API):</label>
            <input type="text" id="ipAddress" value="14.96.107.174">
        </div>

        <button id="verifyButton">Verify Email</button>

        <div id="responseArea" class="hidden">
            <h2>Response:</h2>
            <pre id="jsonResponse"></pre>
        </div>
        <div id="errorArea" class="hidden">
            <h2>Error:</h2>
            <pre id="errorMessage"></pre>
        </div>
    </div>

    <script>
        const verifyButton = document.getElementById('verifyButton');
        const emailInput = document.getElementById('email');
        const ipAddressInput = document.getElementById('ipAddress');
        const responseArea = document.getElementById('responseArea');
        const jsonResponse = document.getElementById('jsonResponse');
        const errorArea = document.getElementById('errorArea');
        const errorMessage = document.getElementById('errorMessage');

        verifyButton.addEventListener('click', async () => {
            const email = emailInput.value;
            const ipAddress = ipAddressInput.value;

            if (!email) {
                alert('Please enter an email address.');
                return;
            }

            responseArea.classList.add('hidden');
            errorArea.classList.add('hidden');
            jsonResponse.textContent = '';
            errorMessage.textContent = '';
            verifyButton.disabled = true;
            verifyButton.textContent = 'Verifying...';

            const proxyUrl = 'https://cors-anywhere.herokuapp.com/';
            const targetApiUrl = 'https://salesblink.io/email-verify';
            const apiUrl = proxyUrl + targetApiUrl;

            const payload = {
                email: email,
                ipAddress: ipAddress
            };

            // --- MODIFICATION: Added X-Requested-With header ---
            const headers = {
                'accept': 'application/json',
                'accept-language': 'en-US,en;q=0.9',
                'content-type': 'application/json',
                'ma-key': 'test',
                'X-Requested-With': 'XMLHttpRequest' // Often required by cors-anywhere
            };
            // --- END MODIFICATION ---

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: headers,
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    let errorText;
                    try {
                        errorText = await response.text(); // Get raw text first
                    } catch (e) {
                        errorText = `Failed to read error response body. Status: ${response.status}`;
                    }

                    // --- MODIFICATION: Better error message for proxy 403 ---
                    if (response.status === 403 && errorText && errorText.toLowerCase().includes('see /corsdemo for more info')) {
                         throw new Error(`Proxy error (Status: 403 Forbidden).\nThis usually means you need to activate the cors-anywhere demo server.\nPlease visit ${proxyUrl} in a new tab (or click the link in the warning above), click the button "Request temporary access to the demo server", and then try verifying the email again.`);
                    }
                    // --- END MODIFICATION ---
                    
                    let errorData = errorText; // Default to text
                    const contentType = response.headers.get("content-type");
                    // Try to parse as JSON only if the content type suggests it, and it's not the specific proxy error text
                    if (contentType && contentType.indexOf("application/json") !== -1) {
                        try {
                            errorData = JSON.parse(errorText);
                        } catch (e) {
                            // Keep errorData as text if JSON parsing fails
                        }
                    }
                    
                    throw new Error(`HTTP error! Status: ${response.status}. Response: ${typeof errorData === 'string' ? errorData : JSON.stringify(errorData, null, 2)}`);
                }

                const data = await response.json();
                jsonResponse.textContent = JSON.stringify(data, null, 2);
                responseArea.classList.remove('hidden');

            } catch (error) {
                console.error('Fetch error details:', error);
                errorMessage.textContent = error.message;
                if (!error.message.toLowerCase().includes('proxy error') && error.message.toLowerCase().includes('failed to fetch')) {
                    errorMessage.textContent += `\n\nThis can happen if the proxy is down, rate-limiting, or if there's a network issue. Check the browser's developer console (F12) for more details.`;
                }
                errorArea.classList.remove('hidden');
            } finally {
                verifyButton.disabled = false;
                verifyButton.textContent = 'Verify Email';
            }
        });
    </script>
</body>
</html>